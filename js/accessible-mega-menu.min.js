(function(b,r,u){function w(e,n){this.element=e;this.settings=b.extend({},x,n);this._defaults=x;this._name="accessibleMegaMenu";this.focusTimeoutID=this.mouseTimeoutID=null;this.justFocused=this.mouseFocused=!1;this.init()}function v(e){return b.expr.filters.visible(e)&&!b(e).parents().addBack().filter(function(){return"hidden"===b.css(this,"visibility")}).length}function y(e,n){var l=e.nodeName.toLowerCase();if("area"===l){l=e.parentNode;var r=l.name;if(!e.href||!r||"map"!==l.nodeName.toLowerCase())return!1;
l=b("img[usemap=#"+r+"]")[0];return!!l&&v(l)}return(/input|select|textarea|button|object/.test(l)?!e.disabled:"a"===l?e.href||n:n)&&v(e)}var x={uuidPrefix:"menu",menuClass:"menu",topNavItemClass:"menu-top-nav-item",panelClass:"menu-panel",panelGroupClass:"menu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open"},C={48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",
78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."};w.prototype=function(){var e=0,n="",l="function"===typeof r.hasOwnProperty&&!!r.hasOwnProperty("ontouchstart");var x=function(a){return b(a).closest(":data(plugin_accessibleMegaMenu)").data("plugin_accessibleMegaMenu")};var v=function(a){a=b(a);var d=this.settings;a.attr("id")||a.attr("id",d.uuidPrefix+"-"+(new Date).getTime()+
"-"+ ++e)};var q=function(a,d){var c=b(a.target),f=this,g=this.settings,e=this.menu,m=c.closest("."+g.topNavItemClass),k=c.hasClass(g.panelClass)?c:c.closest("."+g.panelClass);A.call(this,!0);if(d)if(m=e.find("."+g.topNavItemClass+" ."+g.openClass+":first").closest("."+g.topNavItemClass),m.is(a.relatedTarget)||0<m.has(a.relatedTarget).length)0===m.length&&e.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(g.openClass).filter("."+g.panelClass).attr("aria-hidden","true");else{if("mouseout"!==
a.type&&"focusout"!==a.type||!(0<m.has(u.activeElement).length))if(m.find("[aria-expanded]").attr("aria-expanded","false").removeClass(g.openClass).filter("."+g.panelClass).attr("aria-hidden","true"),"keydown"===a.type&&27===a.keyCode||"DOMAttrModified"===a.type){var p=m.find(":tabbable:first");setTimeout(function(){e.find("[aria-expanded]."+f.settings.panelClass).off("DOMAttrModified.menu");p.focus();f.justFocused=!1},99)}}else clearTimeout(f.focusTimeoutID),m.siblings().find("[aria-expanded]").attr("aria-expanded",
"false").removeClass(g.openClass).filter("."+g.panelClass).attr("aria-hidden","true"),m.find("[aria-expanded]").attr("aria-expanded","true").addClass(g.openClass).filter("."+g.panelClass).attr("aria-hidden","false"),"mouseover"===a.type&&c.is(":tabbable")&&1===m.length&&0===k.length&&0<e.has(u.activeElement).length&&(c.focus(),f.justFocused=!1),A.call(f)};var z=function(a){var d=b(a.currentTarget),c=d.closest("."+this.settings.topNavItemClass),f=d.closest("."+this.settings.panelClass);1===c.length&&
0===f.length&&1===c.find("."+this.settings.panelClass).length&&(d.hasClass(this.settings.openClass)?this.justFocused?(a.preventDefault(),a.stopPropagation(),this.justFocused=!1):l&&(a.preventDefault(),a.stopPropagation(),q.call(this,a,!d.hasClass(this.settings.openClass))):(a.preventDefault(),a.stopPropagation(),q.call(this,a),this.justFocused=!1))};var y=function(a){0===b(a.target).closest(this.menu).length&&(a.preventDefault(),a.stopPropagation(),q.call(this,a,!0))};var D=function(a){"aria-expanded"===
a.originalEvent.attrName&&"false"===a.originalEvent.newValue&&b(a.target).hasClass(this.settings.openClass)&&(a.preventDefault(),a.stopPropagation(),q.call(this,a,!0))};var E=function(a){clearTimeout(this.focusTimeoutID);var d=b(a.target),c=d.closest("."+this.settings.panelClass);d.addClass(this.settings.focusClass).on("click.menu",b.proxy(z,this));this.justFocused=!this.mouseFocused;this.mouseFocused=!1;this.panels.not(c).filter("."+this.settings.openClass).length&&q.call(this,a)};var F=function(a){this.justFocused=
!1;var d=this,c=b(a.target),f=c.closest("."+this.settings.topNavItemClass);c.removeClass(this.settings.focusClass).off("click.menu");d.focusTimeoutID=r.cvox?setTimeout(function(){r.cvox.Api.getCurrentNode(function(b){f.has(b).length?clearTimeout(d.focusTimeoutID):d.focusTimeoutID=setTimeout(function(a,b,c){q.call(a,b,c)},275,d,a,!0)})},25):setTimeout(function(){q.call(d,a,!0)},300)};var B=function(a){var d=this.constructor===w?this:x(this),c=d.settings,f=b(b(this).is("."+c.hoverClass+":tabbable")?
this:a.target),g=d.menu,e=d.topnavitems,m=f.closest("."+c.topNavItemClass),k=g.find(":tabbable"),p=f.hasClass(c.panelClass)?f:f.closest("."+c.panelClass),h=p.find("."+c.panelGroupClass),l=f.closest("."+c.panelGroupClass),v=a.keyCode||a.which;g=!1;var u=C[a.keyCode]||"";p=1===m.length&&0===p.length;if(!f.is("input:focus, select:focus, textarea:focus, button:focus")){f.is("."+c.hoverClass+":tabbable")&&b("html").off("keydown.menu");switch(v){case 27:q.call(d,a,!0);break;case 40:a.preventDefault();p?
(q.call(d,a),g=1===m.find("."+c.panelClass+" :tabbable:first").focus().length):g=1===k.filter(":gt("+k.index(f)+"):first").focus().length;!g&&r.opera&&"[object Opera]"===opera.toString()&&(a.ctrlKey||a.metaKey)&&(k=b(":tabbable"),h=k.index(f),g=1===b(":tabbable:gt("+b(":tabbable").index(f)+"):first").focus().length);break;case 38:a.preventDefault();if(p&&f.hasClass(c.openClass)){q.call(d,a,!0);var t=e.filter(":lt("+e.index(m)+"):last");t.children("."+c.panelClass).length&&(g=1===t.children().attr("aria-expanded",
"true").addClass(c.openClass).filter("."+c.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())}else p||(g=1===k.filter(":lt("+k.index(f)+"):last").focus().length);!g&&r.opera&&"[object Opera]"===opera.toString()&&(a.ctrlKey||a.metaKey)&&(k=b(":tabbable"),h=k.index(f),g=1===b(":tabbable:lt("+b(":tabbable").index(f)+"):first").focus().length);break;case 39:a.preventDefault();p?g=1===e.filter(":gt("+e.index(m)+"):first").find(":tabbable:first").focus().length:(h.length&&l.length&&
(g=1===h.filter(":gt("+h.index(l)+"):first").find(":tabbable:first").focus().length),g||(g=1===m.find(":tabbable:first").focus().length));break;case 37:a.preventDefault();p?g=1===e.filter(":lt("+e.index(m)+"):last").find(":tabbable:first").focus().length:(h.length&&l.length&&(g=1===h.filter(":lt("+h.index(l)+"):last").find(":tabbable:first").focus().length),g||(g=1===m.find(":tabbable:first").focus().length));break;case 9:h=k.index(f);a.shiftKey&&p&&f.hasClass(c.openClass)?(q.call(d,a,!0),t=e.filter(":lt("+
e.index(m)+"):last"),t.children("."+c.panelClass).length&&(g=t.children().attr("aria-expanded","true").addClass(c.openClass).filter("."+c.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):a.shiftKey&&0<h?g=1===k.filter(":lt("+h+"):last").focus().length:!a.shiftKey&&h<k.length-1?g=1===k.filter(":gt("+h+"):first").focus().length:r.opera&&"[object Opera]"===opera.toString()&&(k=b(":tabbable"),h=k.index(f),g=a.shiftKey?1===b(":tabbable:lt("+b(":tabbable").index(f)+"):last").focus().length:
1===b(":tabbable:gt("+b(":tabbable").index(f)+"):first").focus().length);g&&a.preventDefault();break;case 32:if(p)a.preventDefault(),z.call(d,a);else return!0;break;case 13:return!0;default:clearTimeout(this.keydownTimeoutID);n+=u!==n?u:"";if(0===n.length)return;this.keydownTimeoutID=setTimeout(function(){n=""},1E3);k=p&&!f.hasClass(c.openClass)?k.filter(":not(."+c.panelClass+" :tabbable)"):m.find(":tabbable");a.shiftKey&&(k=b(k.get().reverse()));for(h=0;h<k.length;h++)if(a=k.eq(h),a.is(f)){t=1===
n.length?h+1:h;break}c=new RegExp("^"+n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i");for(h=t;h<k.length;h++)if(a=k.eq(h),f=b.trim(a.text()),c.test(f)){g=!0;a.focus();break}if(!g)for(h=0;h<t;h++)if(a=k.eq(h),f=b.trim(a.text()),c.test(f)){a.focus();break}}d.justFocused=!1}};var G=function(a){if(b(a.target).is(this.settings.panelClass)||b(a.target).closest(":focusable").length)this.mouseFocused=!0;this.mouseTimeoutID=setTimeout(function(){clearTimeout(this.focusTimeoutID)},1)};var H=function(a){clearTimeout(this.mouseTimeoutID);
b(a.target).addClass(this.settings.hoverClass);q.call(this,a);if(b(a.target).is(":tabbable"))b("html").on("keydown.menu",b.proxy(B,a.target))};var I=function(a){var d=this;b(a.target).removeClass(d.settings.hoverClass);d.mouseTimeoutID=setTimeout(function(){q.call(d,a,!0)},250);b(a.target).is(":tabbable")&&b("html").off("keydown.menu")};var A=function(a){var d=this.menu;a?(b("html").off("mouseup.outside-menu, touchend.outside-menu, mspointerup.outside-menu,  pointerup.outside-menu"),d.find("[aria-expanded]."+
this.settings.panelClass).off("DOMAttrModified.menu")):(b("html").on("mouseup.outside-menu, touchend.outside-menu, mspointerup.outside-menu,  pointerup.outside-menu",b.proxy(y,this)),d.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.menu",b.proxy(D,this)))};return{constructor:w,init:function(){var a=this.settings,d=b(this.element),c=d.children().first(),f=c.children();this.start(a,d,c,f)},start:function(a,d,c,f){var g=this;this.settings=a;this.menu=c;this.topnavitems=f;
d.attr("role","navigation");c.addClass(a.menuClass);f.each(function(c,d){d=b(d);d.addClass(a.topNavItemClass);var f=d.find(":tabbable:first");var e=d.children(":not(:tabbable):last");v.call(g,f);e.length&&(v.call(g,e),f.attr({"aria-haspopup":!0,"aria-controls":e.attr("id"),"aria-expanded":!1}),e.attr({role:"group","aria-expanded":!1,"aria-hidden":!0}).addClass(a.panelClass).not("[aria-labelledby]").attr("aria-labelledby",f.attr("id")))});this.panels=c.find("."+a.panelClass);c.on("focusin.menu",":focusable, ."+
a.panelClass,b.proxy(E,this)).on("focusout.menu",":focusable, ."+a.panelClass,b.proxy(F,this)).on("keydown.menu",b.proxy(B,this)).on("mouseover.menu",b.proxy(H,this)).on("mouseout.menu",b.proxy(I,this)).on("mousedown.menu",b.proxy(G,this));if(l)c.on("touchstart.menu",b.proxy(z,this));c.find("hr").attr("role","separator");b(u.activeElement).closest(c).length&&b(u.activeElement).trigger("focusin.menu")},getDefaults:function(){return this._defaults},getOption:function(a){return this.settings[a]},getAllOptions:function(){return this.settings},
setOption:function(a,b,c){this.settings[a]=b;c&&this.init()}}}();b.fn.accessibleMegaMenu=function(e){return this.each(function(){b.data(this,"plugin_accessibleMegaMenu")||b.data(this,"plugin_accessibleMegaMenu",new b.fn.accessibleMegaMenu.AccessibleMegaMenu(this,e))})};b.fn.accessibleMegaMenu.AccessibleMegaMenu=w;b.extend(b.expr[":"],{data:b.expr.createPseudo?b.expr.createPseudo(function(e){return function(n){return!!b.data(n,e)}}):function(e,n,l){return!!b.data(e,l[3])},focusable:function(e){return y(e,
!isNaN(b.attr(e,"tabindex")))},tabbable:function(e){var n=b.attr(e,"tabindex"),l=isNaN(n);return(l||0<=n)&&y(e,!l)}})})(jQuery,window,document);